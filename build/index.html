<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Gamedev.js 2024</title>
		<meta charset="utf-8">
		<meta name="description" content="">
		
		<script>
!function(){var s,c,d;function m(e,t=0,r=1){return e<t?t:r<e?r:e}function t(e=1,t=0){return t+Math.random()*(e-t)}function g(e,t){return e.rotate(_/180*t.rx,_/180*t.ry,_/180*t.rz)}function h(t,r){for(let e=0;e<t;e+=1)r(e,t)}function p(e){P[e].done||(P[e].done=1,r())}function r(){B.getElementById("goals").innerHTML=P.map(({t:e,done:t})=>`<li class="${t?"done":""}">${e}</li>`).join("")}function n(e="cube",{x:t=.5,y:r=.5,z:n=.5}={}){y.add(e,{vertices:[t,r,n,-t,r,n,-t,-r,n,t,r,n,-t,-r,n,t,-r,n,t,r,-n,t,r,n,t,-r,n,t,r,-n,t,-r,n,t,-r,-n,t,r,-n,-t,r,-n,-t,r,n,t,r,-n,-t,r,n,t,r,n,-t,r,n,-t,r,-n,-t,-r,-n,-t,r,n,-t,-r,-n,-t,-r,n,-t,r,-n,t,r,-n,t,-r,-n,-t,r,-n,t,-r,-n,-t,-r,-n,t,-r,n,-t,-r,n,-t,-r,-n,t,-r,n,-t,-r,-n,t,-r,-n],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]})}function u(e,t){return{x:t*Math.cos(e),y:t*Math.sin(e)}}function f(e,t){var r=B.getElementById(e),n=r||B.createElement("canvas");return n.id=e,n.width=n.height=t,r||B.getElementById("loaded").appendChild(n),[n,n.getContext("2d"),t/2]}function o(e=4,t="#f00",r,n=.4,o=600){const[i,a,l]=f(r,o),s=(a.clearRect(0,0,o,o),a.beginPath(),q/e);return h(e,e=>{var{x:t,y:r}=u(s*e,l),{x:t,y:r}=(a.lineTo(l+t,l+r),u(s*e+s/2,l*n));a.lineTo(l+t,l+r)}),a.fillStyle=t,a.fill(),i}function D(){var e=B.getElementById("canvas");w.setup({lockElt:e,keys:{Tab:()=>{p(0),w.toggleLock()}}}),c=o(9,"#ebd694","tf",.3),d=o(11,"#90d59c","plasma",.2),K=o(13,"#702782","photon",.5),e.addEventListener("click",()=>{w.lock()}),y.reset(e),y.clearColor("2a242b"),y.light({x:-1,y:-1.2,z:0}),y.ambient(.8),n("ringWall",{y:10,z:5}),y.group({n:"system"}),["sun","ring","p1","p2"].forEach(e=>y.group({n:e,g:"system"})),["ship","skybox"].forEach(e=>y.group({n:e})),e=o(16,"#de8b6f88","sun",.7),y.sphere({n:"outerSun",g:"sun",size:50,b:"#de8b6f88"}),y.sphere({n:"innerSun",g:"sun",size:46,b:"#de8b6f"}),y.billboard({n:"sunFlare",g:"sun",size:60,b:"#de8b6f",t:e}),y.sphere({n:"planet1",g:"p1",...u(.5,300),size:20,b:"471b6e"}),y.sphere({n:"planet2",g:"p2",...u(.7,400),size:8,b:"b0455a"}),[{z:-499,b:"0000",t:e=function(e){const[t,r]=f(e,800);return h(1400,()=>{r.rect(F.int(0,800),F.int(0,800),1,1)}),r.fillStyle="#ebd694",r.fill(),t}("sf")},{y:-499,rx:-90,b:"0000",t:e},{y:499,rx:90,b:"0000",t:e},{x:-499,ry:90,b:"0000",t:e},{x:499,ry:-90,b:"0000",t:e},{z:499,rx:180,b:"0000",t:e}].forEach((e,t)=>{y.plane({b:"000",...e,n:"skybox"+t,g:"skybox",size:998})}),n("engine",{x:.2,y:.2}),y.pyramid({n:"shipBase",g:"ship",size:.3,b:"5796a1"}),y.cube({n:"shipCube",g:"ship",y:-.15,size:.24,b:"5796a1"}),e={n:"shipEngine1",g:"ship",ry:45,rx:90,x:-.18,y:-.21,size:.3,b:"8bc7bf"},y.engine(e),y.engine({...e,n:"shipEngine2",x:-e.x}),y.cube({n:"shipEngineBack1",g:"ship",x:-.18,y:-.345,size:.075,b:"5796a1"}),y.cube({n:"shipEngineBack2",g:"ship",x:.18,y:-.345,size:.075,b:"5796a1"});const i=2*Math.PI;h(32,(e,t)=>{var r=0===e?0:i*e/t,{x:n,y:o}=(t=180/_*r,u(r,200)),r="r"+e;y.group({n:r,g:"ring"}),y.ringWall({n:"ring"+e,g:r,x:n,y:o,rz:t,size:2,b:"5796a1"}),y.cube({n:"ringBuilding"+e,g:r,x:n,y:o,rz:t,size:5,b:"478691"})}),h(200,e=>{y.billboard({n:"litter"+e,g:"system",x:F.rand(-499,499),y:F.rand(-499,499),z:F.rand(-499,499),size:1,b:"555"})}),h(50,e=>{e={n:"crate"+e,passType:"crate",passthru:["crate"],g:"system",x:F.rand(-499,499),y:F.rand(-499,499),z:F.rand(-499,499),vel:{...new S(void 0,void 0,void 0)},size:3,r:2,b:"de8b6f",rx:t(0,359),ry:t(0,359),rz:t(0,359),hp:3},I.push(e),C[e.n]=e,y.cube(e)}),r()}function U(e,t){e.damage&&t.hp&&(t.hp-=e.damage,e.decay=0,t.hp<=0)&&(t.decay=0)}function O(t){h(t.length,e=>{var r,n;r=t[e],n=t,r.collided||h(n.length,e=>{var t,a,l;e=n[e],r.passthru&&r.passthru.includes(e.passType)||e.passthru&&e.passthru.includes(r.passType)||r===e||e.collided||(t=new S(r,void 0,void 0).distance(e))<=r.r+e.r&&(l=e,e=t,U(((a=r).collided=l).collided=a,l),U(l,a),e=new S(l,void 0,void 0).sub(a).normalize().scale((a.r+l.r-e)/2),new S(a,void 0,void 0).sub(e).copyTo(a),new S(l,void 0,void 0).add(e).copyTo(l),["x","y","z"].forEach(e=>{var t=a.mass||1,r=l.mass||1,n=t+r,o=a.vel[e],i=l.vel[e];a.vel[e]=(t-r)/n*o+2*r/n*i,l.vel[e]=2*t/n*o+(r-t)/n*i}))})})}function j(){const o=L/1e3;var e,t,r=w.down.w?.01:0,[n,i=0]=(w.down.s&&(r=-.005),[E,r]),{x:i,y:a,z:l}=g(new S(0,1,0),E).scale(i),{rx:n,ry:i,rz:a}=(n.thrust={x:i,y:a,z:l},0===r?(y.delete("shipEngineIgnite1"),y.delete("shipEngineIgnite2")):(p(1),r={g:"ship",y:-.393,rx:90,size:.2,t:c},y.plane({...r,n:"shipEngineIgnite1",x:-.18}),y.plane({...r,n:"shipEngineIgnite2",x:.18})),r=w.getClick(),0===E.fireCooldown&&(w.down[" "]||r&&r.locked)&&(p(2),{x:n,y:i,z:a}=E,e=(l=g(new S(0,1,0),E)).scale(r.left?40:15).add(E.vel),l={n:"plasma"+String(Number(new Date)),g:"system",passType:"plasma",x:n,y:i,z:a,vel:{...e},thrust:{...l.scale(r.left?5e-4:1e-4)},friction:0,decay:4,damage:r.left?1:2,r:.5,passthru:["ship","plasma"],mass:.01},I.push(l),C[l.n]=l,y.billboard({...l,size:1,t:r.left?d:K}),E.fireCooldown=.3),O(I),I.forEach(e=>{var r,n;e.collided=0,r=e,n=o,["x","y","z"].forEach(e=>{let t=r.thrust&&r.thrust[e]||0;0===t&&0!==r.friction&&(t=1e-4*-r.vel[e]),r.vel[e]=m(r.vel[e]+t/(r.mass||1)/n,-1e3,1e3),r.vel[e]<1e-4&&-1e-4<r.vel[e]&&(r.vel[e]=0),r[e]=m(r[e]+r.vel[e]*n,-499,499)})}),r=w.getLockMove(),T.ry-=r.x/10,T.rx-=r.y/10,["rx","ry","rz"].forEach(e=>{var t=E[e];return t+=.1*(T[e]-t),E[e]=t}),r=g(new S(0,A.back,A.up),T),y.camera({...r,...function(e,t){var{rx:e,ry:r,rz:n}=e;return{rx:e+=t.rx,ry:r+=t.ry,rz:n+=t.rz}}(A,T),a:1e3}),E);y.move({n:"ship",rx:n,ry:i,rz:a}),E.fireCooldown=Math.max(E.fireCooldown-o,0),Object.keys(C).forEach(e=>{const t=C[e];"number"==typeof t.decay&&(t.decay-=o,t.decay<=0)&&(y.delete(t.n),delete C[e],e=I.findIndex(e=>e.n===t.n),I.splice(e,1))}),s+=L/90,W+=L/100,t={...C,system:{x:-E.x,y:-E.y,z:-E.z,a:L},innerSun:{rx:s,ry:W},p1:{rz:.1*s},p2:{rz:.15*s},ring:{rz:.5*s}},Object.keys(t).forEach(e=>{y.move({n:e,...t[e]},0)})}let i,y={models:{},reset:e=>{y.canvas=e,y.objs=0,y.current={},y.next={},y.textures={},y.gl=e.getContext("webgl2"),y.gl.blendFunc(770,771),y.gl.activeTexture(33984),y.program=y.gl.createProgram(),y.gl.enable(2884),y.gl.shaderSource(i=y.gl.createShader(35633),"#version 300 es\n      precision highp float;                        // Set default float precision\n      in vec4 pos, col, uv, normal;                 // Vertex attributes: position, color, texture coordinates, normal (if any)\n      uniform mat4 pv, eye, m, im;                  // Uniform transformation matrices: projection * view, eye, model, inverse model\n      uniform vec4 bb;                              // If the current shape is a billboard: bb = [w, h, 1.0, 0.0]\n      out vec4 v_pos, v_col, v_uv, v_normal;        // Varyings sent to the fragment shader: position, color, texture coordinates, normal (if any)\n      void main() {                                 \n        gl_Position = pv * (                        // Set vertex position: p * v * v_pos\n          v_pos = bb.z > 0.                         // Set v_pos varying:\n          ? m[3] + eye * (pos * bb)                 // Billboards always face the camera:  p * v * distance + eye * (position * [w, h, 1.0, 0.0])\n          : m * pos                                 // Other objects rotate normally:      p * v * m * position\n        );                                          \n        v_col = col;                                // Set varyings \n        v_uv = uv;\n        v_normal = transpose(inverse(m)) * normal;  // recompute normals to match model thansformation\n      }"),y.gl.compileShader(i),y.gl.attachShader(y.program,i),console.log("vertex shader:",y.gl.getShaderInfoLog(i)||"OK"),y.gl.shaderSource(i=y.gl.createShader(35632),"#version 300 es\n      precision highp float;                  // Set default float precision\n      in vec4 v_pos, v_col, v_uv, v_normal;   // Varyings received from the vertex shader: position, color, texture coordinates, normal (if any)\n      uniform vec3 light;                     // Uniform: light direction, smooth normals enabled\n      uniform vec4 o;                         // options [smooth, shading enabled, ambient, mix]\n      uniform sampler2D sampler;              // Uniform: 2D texture\n      out vec4 c;                             // Output: final fragment color\n\n      // The code below displays colored / textured / shaded fragments\n      void main() {\n        c = mix(texture(sampler, v_uv.xy), v_col, o[3]);  // base color (mix of texture and rgba)\n        if(o[1] > 0.){                                    // if lighting/shading is enabled:\n          c = vec4(                                       // output = vec4(base color RGB * (directional shading + ambient light)), base color Alpha\n            c.rgb * (max(0., dot(light, -normalize(       // Directional shading: compute dot product of light direction and normal (0 if negative)\n              o[0] > 0.                                   // if smooth shading is enabled:\n              ? vec3(v_normal.xyz)                        // use smooth normals passed as varying\n              : cross(dFdx(v_pos.xyz), dFdy(v_pos.xyz))   // else, compute flat normal by making a cross-product with the current fragment and its x/y neighbours\n            )))\n            + o[2]),                                      // add ambient light passed as uniform\n            c.a                                           // use base color's alpha\n          );\n        }\n      }"),y.gl.compileShader(i),y.gl.attachShader(y.program,i),console.log("fragment shader:",y.gl.getShaderInfoLog(i)||"OK"),y.gl.linkProgram(y.program),y.gl.useProgram(y.program),console.log("program:",y.gl.getProgramInfoLog(y.program)||"OK"),y.gl.clearColor(1,1,1,1),y.clearColor=e=>y.gl.clearColor(...y.col(e)),y.clearColor("fff"),y.gl.enable(2929),y.light({y:-1}),y.camera({fov:30}),setTimeout(y.draw,16)},setState:(e,t,r)=>{e.n||(e.n="o"+y.objs++),e.size&&(e.w=e.h=e.d=e.size),e.t&&e.t.width&&!y.textures[e.t.id]&&(r=y.gl.createTexture(),y.gl.pixelStorei(37441,!0),y.gl.bindTexture(3553,r),y.gl.pixelStorei(37440,1),y.gl.texImage2D(3553,0,6408,6408,5121,e.t),y.gl.generateMipmap(3553),y.textures[e.t.id]=r),e.fov&&(y.projection=new DOMMatrix([1/Math.tan(e.fov*Math.PI/180)/(y.canvas.width/y.canvas.height),0,0,0,0,1/Math.tan(e.fov*Math.PI/180),0,0,0,0,-1001/999,-1,0,0,-2002/999,0])),e={type:t,...y.current[e.n]=y.next[e.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mode:4,mix:0},...e,f:0},null==(r=y.models[e.type])||!r.vertices||null!=(t=y.models)&&t[e.type].verticesBuffer||(y.gl.bindBuffer(34962,y.models[e.type].verticesBuffer=y.gl.createBuffer()),y.gl.bufferData(34962,new Float32Array(y.models[e.type].vertices),35044),!y.models[e.type].normals&&y.smooth&&y.smooth(e),y.models[e.type].normals&&(y.gl.bindBuffer(34962,y.models[e.type].normalsBuffer=y.gl.createBuffer()),y.gl.bufferData(34962,new Float32Array(y.models[e.type].normals.flat()),35044))),null!=(r=y.models[e.type])&&r.uv&&!y.models[e.type].uvBuffer&&(y.gl.bindBuffer(34962,y.models[e.type].uvBuffer=y.gl.createBuffer()),y.gl.bufferData(34962,new Float32Array(y.models[e.type].uv),35044)),null!=(t=y.models[e.type])&&t.indices&&!y.models[e.type].indicesBuffer&&(y.gl.bindBuffer(34963,y.models[e.type].indicesBuffer=y.gl.createBuffer()),y.gl.bufferData(34963,new Uint16Array(y.models[e.type].indices),35044)),e.t?e.t&&!e.mix&&(e.mix=0):e.mix=1,y.next[e.n]=e},draw:(e,t,r,n,o=[])=>{for(n in t=e-y.lastFrame,y.lastFrame=e,requestAnimationFrame(y.draw),y.next.camera.g&&y.render(y.next[y.next.camera.g],t,1),r=y.animation("camera"),null!=(e=y.next)&&null!=(e=e.camera)&&e.g&&r.preMultiplySelf(y.next[y.next.camera.g].M||y.next[y.next.camera.g].m),y.gl.uniformMatrix4fv(y.gl.getUniformLocation(y.program,"eye"),!1,r.toFloat32Array()),r.invertSelf(),r.preMultiplySelf(y.projection),y.gl.uniformMatrix4fv(y.gl.getUniformLocation(y.program,"pv"),!1,r.toFloat32Array()),y.gl.clear(16640),y.next)y.next[n].t||1!=y.col(y.next[n].b)[3]?o.push(y.next[n]):y.render(y.next[n],t);o.sort((e,t)=>y.dist(t)-y.dist(e)),y.gl.enable(3042);for(n of o)["plane","billboard"].includes(n.type)&&y.gl.depthMask(0),y.render(n,t),y.gl.depthMask(1);y.gl.disable(3042),y.gl.uniform3f(y.gl.getUniformLocation(y.program,"light"),y.lerp("light","x"),y.lerp("light","y"),y.lerp("light","z"))},render:(e,t,r=["camera","light","group"].includes(e.type),n)=>{e.t&&(y.gl.bindTexture(3553,y.textures[e.t.id]),y.gl.uniform1i(y.gl.getUniformLocation(y.program,"sampler"),0)),e.f<e.a&&(e.f+=t),e.f>e.a&&(e.f=e.a),y.next[e.n].m=y.animation(e.n),y.next[e.g]&&y.next[e.n].m.preMultiplySelf(y.next[e.g].M||y.next[e.g].m),y.gl.uniformMatrix4fv(y.gl.getUniformLocation(y.program,"m"),!1,(y.next[e.n].M||y.next[e.n].m).toFloat32Array()),y.gl.uniformMatrix4fv(y.gl.getUniformLocation(y.program,"im"),!1,new DOMMatrix(y.next[e.n].M||y.next[e.n].m).invertSelf().toFloat32Array()),r||(y.gl.bindBuffer(34962,y.models[e.type].verticesBuffer),y.gl.vertexAttribPointer(n=y.gl.getAttribLocation(y.program,"pos"),3,5126,!1,0,0),y.gl.enableVertexAttribArray(n),y.models[e.type].uvBuffer&&(y.gl.bindBuffer(34962,y.models[e.type].uvBuffer),y.gl.vertexAttribPointer(n=y.gl.getAttribLocation(y.program,"uv"),2,5126,!1,0,0),y.gl.enableVertexAttribArray(n)),(e.s||y.models[e.type].customNormals)&&y.models[e.type].normalsBuffer&&(y.gl.bindBuffer(34962,y.models[e.type].normalsBuffer),y.gl.vertexAttribPointer(n=y.gl.getAttribLocation(y.program,"normal"),3,5126,!1,0,0),y.gl.enableVertexAttribArray(n)),y.gl.uniform4f(y.gl.getUniformLocation(y.program,"o"),e.s,(3<e.mode||3<y.gl[e.mode])&&!e.ns?1:0,y.ambientLight||.2,e.mix),y.gl.uniform4f(y.gl.getUniformLocation(y.program,"bb"),e.w,e.h,"billboard"==e.type,0),y.models[e.type].indicesBuffer&&y.gl.bindBuffer(34963,y.models[e.type].indicesBuffer),y.gl.vertexAttrib4fv(y.gl.getAttribLocation(y.program,"col"),y.col(e.b)),y.models[e.type].indicesBuffer?y.gl.drawElements(+e.mode||y.gl[e.mode],y.models[e.type].indices.length,5123,0):y.gl.drawArrays(+e.mode||y.gl[e.mode],0,y.models[e.type].vertices.length/3))},lerp:(e,t)=>{var r;return null!=(r=y.next[e])&&r.a?y.current[e][t]+y.next[e].f/y.next[e].a*(y.next[e][t]-y.current[e][t]):y.next[e][t]},animation:(e,t=new DOMMatrix)=>y.next[e]?t.translateSelf(y.lerp(e,"x"),y.lerp(e,"y"),y.lerp(e,"z")).rotateSelf(y.lerp(e,"rx"),y.lerp(e,"ry"),y.lerp(e,"rz")).scaleSelf(y.lerp(e,"w"),y.lerp(e,"h"),y.lerp(e,"d")):t,dist:(e,t=y.next.camera)=>null!=e&&e.m&&null!=t&&t.m?(t.m.m41-e.m.m41)**2+(t.m.m42-e.m.m42)**2+(t.m.m43-e.m.m43)**2:0,ambient:e=>y.ambientLight=e,col:t=>[...t.replace("#","").match(t.length<5?/./g:/../g).map(e=>("0x"+e)/(t.length<5?15:255)),1],add:(t,e)=>{(y.models[t]=e).normals&&(y.models[t].customNormals=1),y[t]=e=>y.setState(e,t)},group:e=>y.setState(e,"group"),move:(e,t)=>setTimeout(()=>{y.setState(e)},t||1),delete:(e,t)=>setTimeout(()=>{delete y.next[e]},t||1),camera:(e,t)=>setTimeout(()=>{y.setState(e,e.n="camera")},t||1),light:(e,t)=>t?setTimeout(()=>{y.setState(e,e.n="light")},t):y.setState(e,e.n="light"),smooth:(e,t={},r=[],n,o,i,a,l,s,c,d,m,g,h,p,u)=>{for(y.models[e.type].normals=[],i=0;i<y.models[e.type].vertices.length;i+=3)r.push(y.models[e.type].vertices.slice(i,i+3));for(o=(n=y.models[e.type].indices)?1:(n=r,0),i=0;i<2*n.length;i+=3){var f;a=i%n.length,l=r[d=o?y.models[e.type].indices[a]:a],s=r[m=o?y.models[e.type].indices[1+a]:1+a],c=r[g=o?y.models[e.type].indices[2+a]:2+a],p=[s[0]-l[0],s[1]-l[1],s[2]-l[2]],u=[c[0]-s[0],c[1]-s[1],c[2]-s[2]],h=a<i?[0,0,0]:[p[1]*u[2]-p[2]*u[1],p[2]*u[0]-p[0]*u[2],p[0]*u[1]-p[1]*u[0]],t[f=l[0]+"_"+l[1]+"_"+l[2]]||(t[f]=[0,0,0]),t[f=s[0]+"_"+s[1]+"_"+s[2]]||(t[f]=[0,0,0]),t[f=c[0]+"_"+c[1]+"_"+c[2]]||(t[f]=[0,0,0]),y.models[e.type].normals[d]=t[l[0]+"_"+l[1]+"_"+l[2]]=t[l[0]+"_"+l[1]+"_"+l[2]].map((e,t)=>e+h[t]),y.models[e.type].normals[m]=t[s[0]+"_"+s[1]+"_"+s[2]]=t[s[0]+"_"+s[1]+"_"+s[2]].map((e,t)=>e+h[t]),y.models[e.type].normals[g]=t[c[0]+"_"+c[1]+"_"+c[2]]=t[c[0]+"_"+c[1]+"_"+c[2]].map((e,t)=>e+h[t])}}};y.add("plane",{vertices:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),y.add("billboard",y.models.plane),y.add("cube",{vertices:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),y.cube=e=>y.setState(e,"cube"),y.add("pyramid",{vertices:[-.5,-.5,.5,.5,-.5,.5,0,.5,0,.5,-.5,.5,.5,-.5,-.5,0,.5,0,.5,-.5,-.5,-.5,-.5,-.5,0,.5,0,-.5,-.5,-.5,-.5,-.5,.5,0,.5,0,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,1,0,1,0,0,1,1,0,0,1,0]});var[e,a,l,v,x,b,V=[],Y=[],X=[]]=[];for(l=0;l<=20;l++)for(v=l*Math.PI/20,e=0;e<=20;e++)a=2*e*Math.PI/20,V.push(+(Math.sin(a)*Math.sin(v)/2).toFixed(6),+(Math.cos(v)/2).toFixed(6),+(Math.cos(a)*Math.sin(v)/2).toFixed(6)),X.push(3.5*Math.sin(e/20),-Math.sin(l/20)),e<20&&l<20&&Y.push(x=21*l+e,b=x+21,x+1,x+1,b,b+1);y.add("sphere",{vertices:V,uv:X,indices:Y});const z=window.document;var w={lockMove:{x:0,y:0},move:{x:0,y:0},wheel:0,click:null,lockElt:null,down:{},isLocked:()=>!!z.pointerLockElement,async lock(){z.pointerLockElement||await this.lockElt.requestPointerLock()},async toggleLock(){z.pointerLockElement?await this.unlock():await this.lock()},async unlock(){await z.exitPointerLock()},getLockMove(){var e={...this.lockMove};return this.lockMove.x=0,this.lockMove.y=0,e},getWheel(){var e=this.wheel;return this.wheel=0,e},getClick(){var e=this.click;return this.click=null,e},setup(t={}){this.lockElt=t.lockElt,onmousemove=e=>{var t=this[z.pointerLockElement?"lockMove":"move"];t.x+=e.movementX,t.y+=e.movementY},onkeydown=e=>{this.down[e.key]=!0,!e.repeat&&t.keys&&t.keys[e.key]&&(t.keys[e.key](),e.preventDefault())},onkeyup=e=>{this.down[e.key]=!1},onwheel=e=>{this.wheel+=e.deltaY};oncontextmenu=onclick=e=>{var{clientX:e,clientY:t,button:r}=e;this.click={clientX:e,clientY:t,button:r,left:0===r,right:2===r,locked:!!z.pointerLockElement}}}};const k=Math.sin,M=Math.cos;class S{constructor(e=0,t=0,r=0){"object"==typeof e&&(t=e.y,r=e.z,e=e.x),this.x=e,this.y=t,this.z=r}copy(){return new S(this.x,this.y,this.z)}copyTo(e){e.x=this.x,e.y=this.y,e.z=this.z}add(e){return new S(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new S(this.x-e.x,this.y-e.y,this.z-e.z)}length(){return(this.x**2+this.y**2+this.x**2)**.5}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2+(this.z-e.z)**2}normalize(e=1){var t=this.length();return t?this.scale(e/t):new S(0,e,0)}scale(e){return new S(this.x*e,this.y*e,this.z*e)}rotate(e,t,r){return this.rotateX(e).rotateY(t).rotateZ(r)}rotateX(e=0){var t=this.x,r=this.y*M(e)-this.z*k(e);return e=this.y*k(e)+this.z*M(e),new S(t,r,e)}rotateY(e=0){var t=this.x*M(e)+this.z*k(e),r=this.y;return e=-this.x*k(e)+this.z*M(e),new S(t,r,e)}rotateZ(e=0){var t=this.x*M(e)-this.y*k(e);return e=this.x*k(e)+this.y*M(e),new S(t,e,this.z)}}const _=Math.PI,q=2*_,B=document;var W=s=0;const E={x:0,y:0,z:499,rx:-90,ry:0,rz:0,vel:{x:0,y:0,z:-16},thrust:{x:0,y:0,z:0},fireCooldown:0,r:2,passType:"ship",passthru:["plasma"]},L=1e3/60,A={back:-1.5,up:.51,rx:80,ry:0,rz:0},T={rx:-90,ry:0,rz:0},I=[E],C={},F=new class{constructor(e){this.seed=e}rand(e=1,t=0){return this.seed^=this.seed<<13,this.seed^=this.seed>>>17,this.seed^=this.seed<<5,t+(e-t)*Math.abs(this.seed%1e9)/1e9}int(e,t=0){return Math.floor(this.rand(e,t))}sign(){return 2*this.randInt(2)-1}}(1233);var K=d=c=void 0;const P=["Check steering: [Tab] to toggle mouse-lock","Thrusters: [W]","Fire weapons: [Space] or [Click]"].map(e=>({t:e,done:0}));addEventListener("DOMContentLoaded",()=>{D(),setInterval(j,L)}),window.g={renderables:C,ship:E,input:w,physicsEnts:I}}();
</script>
		<style>
			body {
				background: #111;
				padding: 0;
				margin: 0;
				overflow: hidden;
				color: #ebd694;
				font-family: 'Trebuchet MS', Arial, sans-serif;
				text-align: center;
			}
			#canvas {
				width: 100vmin;
				height: 100vmin;
				margin: 0 auto;
			}
			/* canvas { image-rendering: pixelated; } */
			#goals {
				position: absolute;
				top: 0;
				right: 0;
				list-style-type: square;
			}
			.done {
				text-decoration: line-through;
				opacity: 0.5;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas" width="800" height="800"></canvas>
		<p id="goals">[Tab] = 🖱️ Mouselock steering</p>
		<i id="loaded" style="display: none"></i>
	</body>
</html>
