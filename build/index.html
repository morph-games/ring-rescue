<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Gamedev.js 2024</title>
		<meta charset="utf-8">
		<meta name="description" content="">
		
		<script>
!function(){var a;function t(e="cube",{x:t=.5,y:r=.5,z:n=.5}={}){f.add(e,{vertices:[t,r,n,-t,r,n,-t,-r,n,t,r,n,-t,-r,n,t,-r,n,t,r,-n,t,r,n,t,-r,n,t,r,-n,t,-r,n,t,-r,-n,t,r,-n,-t,r,-n,-t,r,n,t,r,-n,-t,r,n,t,r,n,-t,r,n,-t,r,-n,-t,-r,-n,-t,r,n,-t,-r,-n,-t,-r,n,-t,r,-n,t,r,-n,t,-r,-n,-t,r,-n,t,-r,-n,-t,-r,-n,t,-r,n,-t,-r,n,-t,-r,-n,t,-r,n,-t,-r,-n,t,-r,-n],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]})}function i(e,t=0,r=1){return e<t?t:r<e?r:e}function r(e=1,t=0){return t+Math.random()*(e-t)}function s(e,t){return e.rotate(k/180*t.rx,k/180*t.ry,k/180*t.rz)}function g(e){var t=e["facing"];return s(new S(t,void 0,void 0),e)}function c(t,r){for(let e=0;e<t;e+=1)r(e,t)}function l(e){F[e].done||(F[e].done=1,D())}function D(){_.getElementById("goals").innerHTML=F.map(({t:e,done:t})=>`<li class="${t?"done":""}">${e}</li>`).join("")}function d(e,t){return{x:t*Math.cos(e),y:t*Math.sin(e)}}function O(e,t){var r=_.getElementById(e),n=r||_.createElement("canvas");return n.id=e,n.width=n.height=t,r||_.getElementById("loaded").appendChild(n),[n,n.getContext("2d"),t/2]}function n(e=4,t="#f00",r,n=.4,o=600){const[a,i,s]=O(r,o),l=(i.clearRect(0,0,o,o),i.beginPath(),H/e);return c(e,e=>{var{x:t,y:r}=d(l*e,s),{x:t,y:r}=(i.lineTo(s+t,s+r),d(l*e+l/2,s*n));i.lineTo(s+t,s+r)}),i.fillStyle=t,i.fill(),a}function U(e){const t="k"+e;var r={x:I.rand(-499,499),y:I.rand(-499,499),z:I.rand(-499,499)};e={n:t,...structuredClone(Q),...r,size:5,radius:5},f.group({n:t,g:"system",...r});const n={g:t,size:2.5,x:-1.5,b:"372b4e"};r={g:t,size:2,b:"471b6e"},f.cube({...n,n:t+"c",rx:45,b:"471b6e"}),c(4,e=>{f.cube({...n,n:t+"cc"+e,x:-2-e,size:2.5-.5*e})}),f.pyramid({n:t+"nose",rz:-90,g:t,size:1.5,b:"90d59c"}),f.longRect({...r,n:t+"wing1",y:2,rx:90,ry:45,rz:-45}),f.longRect({...r,n:t+"wing2",y:2,x:1.5,rx:90,ry:45,rz:45,b:"471b6e"}),f.longRect({...r,n:t+"wing3",y:-2,rx:90,ry:45,rz:45}),f.longRect({...r,n:t+"wing4",y:-2,x:1.5,rx:90,ry:45,rz:-45,b:"471b6e"}),f.sphere({n:t+"shield",g:t,size:10,b:"ebd69403"}),A.push(e),T[e.n]=e,ee.push(e)}function j(){var e=_.getElementById("canvas");v.setup({lockElt:e,keys:{Tab:()=>{l(0),v.toggleLock()}}}),P.tf=n(9,"#ebd694","tf",.3),P.plasma=n(11,"#90d59c","plasma",.2),P.photon=n(13,"#702782","photon",.5),e.addEventListener("click",()=>{v.lock()}),f.reset(e),f.clearColor("2a242b"),f.light({x:-1,y:-1.2,z:0}),f.ambient(.8),t("ringWall",{y:10,z:5}),t("longRect",{x:.2,y:.2}),f.group({n:"system"}),["sun","ring","p1","p2"].forEach(e=>f.group({n:e,g:"system"})),["ship","skybox"].forEach(e=>f.group({n:e})),e=n(16,"#de8b6f88","sun",.7),f.sphere({n:"outerSun",g:"sun",size:50,b:"#de8b6f88"}),f.sphere({n:"innerSun",g:"sun",size:46,b:"#de8b6f"}),f.billboard({n:"sunFlare",g:"sun",size:60,b:"#de8b6f",t:e}),f.sphere({n:"planet1",g:"p1",...d(.5,300),size:20,b:"775b5b"}),f.sphere({n:"planet2",g:"p2",...d(.7,400),size:8,b:"b0455a"}),[{z:-499,b:"0000",t:e=function(e){const[t,r]=O(e,800);return c(1400,()=>{r.rect(I.int(0,800),I.int(0,800),1,1)}),r.fillStyle="#ebd694",r.fill(),t}("sf")},{y:-499,rx:-90,b:"0000",t:e},{y:499,rx:90,b:"0000",t:e},{x:-499,ry:90,b:"0000",t:e},{x:499,ry:-90,b:"0000",t:e},{z:499,rx:180,b:"0000",t:e}].forEach((e,t)=>{f.plane({b:"000",...e,n:"skybox"+t,g:"skybox",size:998})}),f.pyramid({n:"shipBase",g:"ship",size:.3,b:"5796a1"}),f.cube({n:"shipCube",g:"ship",y:-.15,size:.24,b:"5796a1"}),e={n:"shipEngine1",g:"ship",ry:45,rx:90,x:-.18,y:-.21,size:.3,b:"8bc7bf"},f.longRect(e),f.longRect({...e,n:"shipEngine2",x:-e.x}),f.cube({n:"shipEngineBack1",g:"ship",x:-.18,y:-.345,size:.075,b:"5796a1"}),f.cube({n:"shipEngineBack2",g:"ship",x:.18,y:-.345,size:.075,b:"5796a1"}),c(5,U);const a=2*Math.PI;c(32,(e,t)=>{var r=0===e?0:a*e/t,{x:n,y:o}=(t=180/k*r,d(r,200)),r="r"+e;f.group({n:r,g:"ring"}),f.ringWall({n:"ring"+e,g:r,x:n,y:o,rz:t,size:2,b:"5796a1"}),f.cube({n:"ringBuilding"+e,g:r,x:n,y:o,rz:t,size:5,b:"478691"})}),c(200,e=>{f.billboard({n:"litter"+e,g:"system",x:I.rand(-499,499),y:I.rand(-499,499),z:I.rand(-499,499),size:1,b:"555"})}),c(50,e=>{e={n:"crate"+e,passType:"crate",passthru:["crate"],g:"system",x:I.rand(-499,499),y:I.rand(-499,499),z:I.rand(-499,499),vel:{...new S(void 0,void 0,void 0)},size:3,r:2,b:"de8b6f",rx:r(0,359),ry:r(0,359),rz:r(0,359),hp:3},A.push(e),T[e.n]=e,f.cube(e)}),D()}function R(e,t=0){var{x:t,y:r,z:n}=g(e).scale(t);e.thrust={x:t,y:r,z:n}}function q(e,t){e.damage&&t.hp&&(t.hp-=e.damage,e.decay=0,t.hp<=0)&&(t.decay=0),e.aggro+=1,t.aggro+=1,e.shieldOpacity+=5,t.shieldOpacity+=5}function V(t){c(t.length,e=>{var r,n;r=t[e],n=t,r.collided||c(n.length,e=>{var t,i,s;e=n[e],r.passthru&&r.passthru.includes(e.passType)||e.passthru&&e.passthru.includes(r.passType)||r===e||e.collided||(t=new S(r,void 0,void 0).distance(e))<=r.r+e.r&&(s=e,e=t,q(((i=r).collided=s).collided=i,s),q(s,i),e=new S(s,void 0,void 0).sub(i).normalize().scale((i.r+s.r-e)/2),new S(i,void 0,void 0).sub(e).copyTo(i),new S(s,void 0,void 0).add(e).copyTo(s),["x","y","z"].forEach(e=>{var t=i.mass||1,r=s.mass||1,n=t+r,o=i.vel[e],a=s.vel[e];i.vel[e]=(t-r)/n*o+2*r/n*a,s.vel[e]=2*t/n*o+(r-t)/n*a}))})})}function W(n,o,a=.01){["rx","ry","rz"].forEach(e=>{var t=n[e],r=o[e];return t+=i(a)*(r-t),n[e]=t})}function Y(e,t,r,n){var{vScale:o,tScale:a,damage:i}=te[e],{x:s,y:l,z:c}=(e=P[e],t),d=g(t);t=d.scale(o).add(t.vel),r={n:"plasma"+String(Number(new Date)),g:"system",passType:r,x:s,y:l,z:c,vel:{...t},thrust:{...d.scale(a)},friction:0,decay:5,damage:i,r:.5,passthru:n,mass:.01},A.push(r),T[r.n]=r,f.billboard({...r,size:1,t:e})}function X(){const o=E/1e3;var e,t,r,n;v.down.p||(e=v.down.w?.01:0,{rx:e,ry:t,rz:r}=(v.down.s&&(e=-.005),R(B,e),0===e?(f.delete("shipEngineIgnite1"),f.delete("shipEngineIgnite2")):(l(1),e={g:"ship",y:-.393,rx:90,size:.2,t:P.tf},f.plane({...e,n:"shipEngineIgnite1",x:-.18}),f.plane({...e,n:"shipEngineIgnite2",x:.18})),e=v.getClick(),0===B.fireCooldown&&(v.down[" "]||e&&e.locked)&&(l(2),Y(e&&e.right?"photon":"plasma",B,"plasma",["ship","plasma"]),B.fireCooldown=.3),ee.forEach(e=>{var t=new S(e,void 0,void 0),r=t.distance(B);r>2*e.sight?e.aggro=M(0,e.aggro-=.1):r<=e.sight&&(e.aggro=M(1,e.aggro)),e.aggro&&(W(e,t=t.toWAngles(B),.01),e.thrustCooldown?e.thrustCooldown=M(e.thrustCooldown-o,0):(R(e,.003),e.thrustCooldown=5),0===e.fireCooldown?(Y("plasma",e,"klaxPlasma",["klaxShip","klaxPlasma"]),e.fireCooldown=1):e.fireCooldown=M(e.fireCooldown-o,0))}),V(A),A.forEach(e=>{var r,n;e.collided=0,r=e,n=o,["x","y","z"].forEach(e=>{let t=r.thrust&&r.thrust[e]||0;0===t&&0!==r.friction&&(t=1e-4*-r.vel[e]),r.vel[e]=i(r.vel[e]+t/(r.mass||1)/n,-1e3,1e3),r.vel[e]<1e-4&&-1e-4<r.vel[e]&&(r.vel[e]=0),r[e]=i(r[e]+r.vel[e]*n,-499,499)})}),e=v.getLockMove(),C.ry-=e.x/10,C.rx-=e.y/10,W(B,C,.05),e=s(new S(0,L.back,L.up),C),f.camera({...e,...function(e,t){var{rx:e,ry:r,rz:n}=e;return{rx:e+=t.rx,ry:r+=t.ry,rz:n+=t.rz}}(L,C),a:1e3}),B),f.move({n:"ship",rx:e,ry:t,rz:r}),B.fireCooldown=M(B.fireCooldown-o,0),Object.keys(T).forEach(e=>{const t=T[e];"number"==typeof t.decay&&(t.decay-=o,t.decay<=0)&&(f.delete(t.n),delete T[e],e=A.findIndex(e=>e.n===t.n),A.splice(e,1))}),a+=E/90,J+=E/100,n={...T,system:{x:-B.x,y:-B.y,z:-B.z,a:E},innerSun:{rx:a,ry:J},p1:{rz:.1*a},p2:{rz:.15*a},ring:{rz:.5*a}},Object.keys(n).forEach(e=>{f.move({n:e,...n[e]},0)}))}let o,f={models:{},reset:e=>{f.canvas=e,f.objs=0,f.current={},f.next={},f.textures={},f.gl=e.getContext("webgl2"),f.gl.blendFunc(770,771),f.gl.activeTexture(33984),f.program=f.gl.createProgram(),f.gl.enable(2884),f.gl.shaderSource(o=f.gl.createShader(35633),"#version 300 es\n      precision highp float;                        // Set default float precision\n      in vec4 pos, col, uv, normal;                 // Vertex attributes: position, color, texture coordinates, normal (if any)\n      uniform mat4 pv, eye, m, im;                  // Uniform transformation matrices: projection * view, eye, model, inverse model\n      uniform vec4 bb;                              // If the current shape is a billboard: bb = [w, h, 1.0, 0.0]\n      out vec4 v_pos, v_col, v_uv, v_normal;        // Varyings sent to the fragment shader: position, color, texture coordinates, normal (if any)\n      void main() {                                 \n        gl_Position = pv * (                        // Set vertex position: p * v * v_pos\n          v_pos = bb.z > 0.                         // Set v_pos varying:\n          ? m[3] + eye * (pos * bb)                 // Billboards always face the camera:  p * v * distance + eye * (position * [w, h, 1.0, 0.0])\n          : m * pos                                 // Other objects rotate normally:      p * v * m * position\n        );                                          \n        v_col = col;                                // Set varyings \n        v_uv = uv;\n        v_normal = transpose(inverse(m)) * normal;  // recompute normals to match model thansformation\n      }"),f.gl.compileShader(o),f.gl.attachShader(f.program,o),console.log("vertex shader:",f.gl.getShaderInfoLog(o)||"OK"),f.gl.shaderSource(o=f.gl.createShader(35632),"#version 300 es\n      precision highp float;                  // Set default float precision\n      in vec4 v_pos, v_col, v_uv, v_normal;   // Varyings received from the vertex shader: position, color, texture coordinates, normal (if any)\n      uniform vec3 light;                     // Uniform: light direction, smooth normals enabled\n      uniform vec4 o;                         // options [smooth, shading enabled, ambient, mix]\n      uniform sampler2D sampler;              // Uniform: 2D texture\n      out vec4 c;                             // Output: final fragment color\n\n      // The code below displays colored / textured / shaded fragments\n      void main() {\n        c = mix(texture(sampler, v_uv.xy), v_col, o[3]);  // base color (mix of texture and rgba)\n        if(o[1] > 0.){                                    // if lighting/shading is enabled:\n          c = vec4(                                       // output = vec4(base color RGB * (directional shading + ambient light)), base color Alpha\n            c.rgb * (max(0., dot(light, -normalize(       // Directional shading: compute dot product of light direction and normal (0 if negative)\n              o[0] > 0.                                   // if smooth shading is enabled:\n              ? vec3(v_normal.xyz)                        // use smooth normals passed as varying\n              : cross(dFdx(v_pos.xyz), dFdy(v_pos.xyz))   // else, compute flat normal by making a cross-product with the current fragment and its x/y neighbours\n            )))\n            + o[2]),                                      // add ambient light passed as uniform\n            c.a                                           // use base color's alpha\n          );\n        }\n      }"),f.gl.compileShader(o),f.gl.attachShader(f.program,o),console.log("fragment shader:",f.gl.getShaderInfoLog(o)||"OK"),f.gl.linkProgram(f.program),f.gl.useProgram(f.program),console.log("program:",f.gl.getProgramInfoLog(f.program)||"OK"),f.gl.clearColor(1,1,1,1),f.clearColor=e=>f.gl.clearColor(...f.col(e)),f.clearColor("fff"),f.gl.enable(2929),f.light({y:-1}),f.camera({fov:30}),setTimeout(f.draw,16)},setState:(e,t,r)=>{e.n||(e.n="o"+f.objs++),e.size&&(e.w=e.h=e.d=e.size),e.t&&e.t.width&&!f.textures[e.t.id]&&(r=f.gl.createTexture(),f.gl.pixelStorei(37441,!0),f.gl.bindTexture(3553,r),f.gl.pixelStorei(37440,1),f.gl.texImage2D(3553,0,6408,6408,5121,e.t),f.gl.generateMipmap(3553),f.textures[e.t.id]=r),e.fov&&(f.projection=new DOMMatrix([1/Math.tan(e.fov*Math.PI/180)/(f.canvas.width/f.canvas.height),0,0,0,0,1/Math.tan(e.fov*Math.PI/180),0,0,0,0,-1001/999,-1,0,0,-2002/999,0])),e={type:t,...f.current[e.n]=f.next[e.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mode:4,mix:0},...e,f:0},null==(r=f.models[e.type])||!r.vertices||null!=(t=f.models)&&t[e.type].verticesBuffer||(f.gl.bindBuffer(34962,f.models[e.type].verticesBuffer=f.gl.createBuffer()),f.gl.bufferData(34962,new Float32Array(f.models[e.type].vertices),35044),!f.models[e.type].normals&&f.smooth&&f.smooth(e),f.models[e.type].normals&&(f.gl.bindBuffer(34962,f.models[e.type].normalsBuffer=f.gl.createBuffer()),f.gl.bufferData(34962,new Float32Array(f.models[e.type].normals.flat()),35044))),null!=(r=f.models[e.type])&&r.uv&&!f.models[e.type].uvBuffer&&(f.gl.bindBuffer(34962,f.models[e.type].uvBuffer=f.gl.createBuffer()),f.gl.bufferData(34962,new Float32Array(f.models[e.type].uv),35044)),null!=(t=f.models[e.type])&&t.indices&&!f.models[e.type].indicesBuffer&&(f.gl.bindBuffer(34963,f.models[e.type].indicesBuffer=f.gl.createBuffer()),f.gl.bufferData(34963,new Uint16Array(f.models[e.type].indices),35044)),e.t?e.t&&!e.mix&&(e.mix=0):e.mix=1,f.next[e.n]=e},draw:(e,t,r,n,o=[])=>{for(n in t=e-f.lastFrame,f.lastFrame=e,requestAnimationFrame(f.draw),f.next.camera.g&&f.render(f.next[f.next.camera.g],t,1),r=f.animation("camera"),null!=(e=f.next)&&null!=(e=e.camera)&&e.g&&r.preMultiplySelf(f.next[f.next.camera.g].M||f.next[f.next.camera.g].m),f.gl.uniformMatrix4fv(f.gl.getUniformLocation(f.program,"eye"),!1,r.toFloat32Array()),r.invertSelf(),r.preMultiplySelf(f.projection),f.gl.uniformMatrix4fv(f.gl.getUniformLocation(f.program,"pv"),!1,r.toFloat32Array()),f.gl.clear(16640),f.next)f.next[n].t||1!=f.col(f.next[n].b)[3]?o.push(f.next[n]):f.render(f.next[n],t);o.sort((e,t)=>f.dist(t)-f.dist(e)),f.gl.enable(3042);for(n of o)["plane","billboard"].includes(n.type)&&f.gl.depthMask(0),f.render(n,t),f.gl.depthMask(1);f.gl.disable(3042),f.gl.uniform3f(f.gl.getUniformLocation(f.program,"light"),f.lerp("light","x"),f.lerp("light","y"),f.lerp("light","z"))},render:(e,t,r=["camera","light","group"].includes(e.type),n)=>{e.t&&(f.gl.bindTexture(3553,f.textures[e.t.id]),f.gl.uniform1i(f.gl.getUniformLocation(f.program,"sampler"),0)),e.f<e.a&&(e.f+=t),e.f>e.a&&(e.f=e.a),f.next[e.n].m=f.animation(e.n),f.next[e.g]&&f.next[e.n].m.preMultiplySelf(f.next[e.g].M||f.next[e.g].m),f.gl.uniformMatrix4fv(f.gl.getUniformLocation(f.program,"m"),!1,(f.next[e.n].M||f.next[e.n].m).toFloat32Array()),f.gl.uniformMatrix4fv(f.gl.getUniformLocation(f.program,"im"),!1,new DOMMatrix(f.next[e.n].M||f.next[e.n].m).invertSelf().toFloat32Array()),r||(f.gl.bindBuffer(34962,f.models[e.type].verticesBuffer),f.gl.vertexAttribPointer(n=f.gl.getAttribLocation(f.program,"pos"),3,5126,!1,0,0),f.gl.enableVertexAttribArray(n),f.models[e.type].uvBuffer&&(f.gl.bindBuffer(34962,f.models[e.type].uvBuffer),f.gl.vertexAttribPointer(n=f.gl.getAttribLocation(f.program,"uv"),2,5126,!1,0,0),f.gl.enableVertexAttribArray(n)),(e.s||f.models[e.type].customNormals)&&f.models[e.type].normalsBuffer&&(f.gl.bindBuffer(34962,f.models[e.type].normalsBuffer),f.gl.vertexAttribPointer(n=f.gl.getAttribLocation(f.program,"normal"),3,5126,!1,0,0),f.gl.enableVertexAttribArray(n)),f.gl.uniform4f(f.gl.getUniformLocation(f.program,"o"),e.s,(3<e.mode||3<f.gl[e.mode])&&!e.ns?1:0,f.ambientLight||.2,e.mix),f.gl.uniform4f(f.gl.getUniformLocation(f.program,"bb"),e.w,e.h,"billboard"==e.type,0),f.models[e.type].indicesBuffer&&f.gl.bindBuffer(34963,f.models[e.type].indicesBuffer),f.gl.vertexAttrib4fv(f.gl.getAttribLocation(f.program,"col"),f.col(e.b)),f.models[e.type].indicesBuffer?f.gl.drawElements(+e.mode||f.gl[e.mode],f.models[e.type].indices.length,5123,0):f.gl.drawArrays(+e.mode||f.gl[e.mode],0,f.models[e.type].vertices.length/3))},lerp:(e,t)=>{var r;return null!=(r=f.next[e])&&r.a?f.current[e][t]+f.next[e].f/f.next[e].a*(f.next[e][t]-f.current[e][t]):f.next[e][t]},animation:(e,t=new DOMMatrix)=>f.next[e]?t.translateSelf(f.lerp(e,"x"),f.lerp(e,"y"),f.lerp(e,"z")).rotateSelf(f.lerp(e,"rx"),f.lerp(e,"ry"),f.lerp(e,"rz")).scaleSelf(f.lerp(e,"w"),f.lerp(e,"h"),f.lerp(e,"d")):t,dist:(e,t=f.next.camera)=>null!=e&&e.m&&null!=t&&t.m?(t.m.m41-e.m.m41)**2+(t.m.m42-e.m.m42)**2+(t.m.m43-e.m.m43)**2:0,ambient:e=>f.ambientLight=e,col:t=>[...t.replace("#","").match(t.length<5?/./g:/../g).map(e=>("0x"+e)/(t.length<5?15:255)),1],add:(t,e)=>{(f.models[t]=e).normals&&(f.models[t].customNormals=1),f[t]=e=>f.setState(e,t)},group:e=>f.setState(e,"group"),move:(e,t)=>setTimeout(()=>{f.setState(e)},t||1),delete:(e,t)=>setTimeout(()=>{delete f.next[e]},t||1),camera:(e,t)=>setTimeout(()=>{f.setState(e,e.n="camera")},t||1),light:(e,t)=>t?setTimeout(()=>{f.setState(e,e.n="light")},t):f.setState(e,e.n="light"),smooth:(e,t={},r=[],n,o,a,i,s,l,c,d,g,m,h,u,p)=>{for(f.models[e.type].normals=[],a=0;a<f.models[e.type].vertices.length;a+=3)r.push(f.models[e.type].vertices.slice(a,a+3));for(o=(n=f.models[e.type].indices)?1:(n=r,0),a=0;a<2*n.length;a+=3){var y;i=a%n.length,s=r[d=o?f.models[e.type].indices[i]:i],l=r[g=o?f.models[e.type].indices[1+i]:1+i],c=r[m=o?f.models[e.type].indices[2+i]:2+i],u=[l[0]-s[0],l[1]-s[1],l[2]-s[2]],p=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],h=i<a?[0,0,0]:[u[1]*p[2]-u[2]*p[1],u[2]*p[0]-u[0]*p[2],u[0]*p[1]-u[1]*p[0]],t[y=s[0]+"_"+s[1]+"_"+s[2]]||(t[y]=[0,0,0]),t[y=l[0]+"_"+l[1]+"_"+l[2]]||(t[y]=[0,0,0]),t[y=c[0]+"_"+c[1]+"_"+c[2]]||(t[y]=[0,0,0]),f.models[e.type].normals[d]=t[s[0]+"_"+s[1]+"_"+s[2]]=t[s[0]+"_"+s[1]+"_"+s[2]].map((e,t)=>e+h[t]),f.models[e.type].normals[g]=t[l[0]+"_"+l[1]+"_"+l[2]]=t[l[0]+"_"+l[1]+"_"+l[2]].map((e,t)=>e+h[t]),f.models[e.type].normals[m]=t[c[0]+"_"+c[1]+"_"+c[2]]=t[c[0]+"_"+c[1]+"_"+c[2]].map((e,t)=>e+h[t])}}};f.add("plane",{vertices:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),f.add("billboard",f.models.plane),f.add("cube",{vertices:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),f.cube=e=>f.setState(e,"cube"),f.add("pyramid",{vertices:[-.5,-.5,.5,.5,-.5,.5,0,.5,0,.5,-.5,.5,.5,-.5,-.5,0,.5,0,.5,-.5,-.5,-.5,-.5,-.5,0,.5,0,-.5,-.5,-.5,-.5,-.5,.5,0,.5,0,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,1,0,1,0,0,1,1,0,0,1,0]});var[e,m,h,u,p,y,K=[],N=[],Z=[]]=[];for(h=0;h<=20;h++)for(u=h*Math.PI/20,e=0;e<=20;e++)m=2*e*Math.PI/20,K.push(+(Math.sin(m)*Math.sin(u)/2).toFixed(6),+(Math.cos(u)/2).toFixed(6),+(Math.cos(m)*Math.sin(u)/2).toFixed(6)),Z.push(3.5*Math.sin(e/20),-Math.sin(h/20)),e<20&&h<20&&N.push(p=21*h+e,y=p+21,p+1,p+1,y,y+1);f.add("sphere",{vertices:K,uv:Z,indices:N});const x=window.document;var v={lockMove:{x:0,y:0},move:{x:0,y:0},wheel:0,click:null,lockElt:null,down:{},isLocked:()=>!!x.pointerLockElement,async lock(){x.pointerLockElement||await this.lockElt.requestPointerLock()},async toggleLock(){x.pointerLockElement?await this.unlock():await this.lock()},async unlock(){await x.exitPointerLock()},getLockMove(){var e={...this.lockMove};return this.lockMove.x=0,this.lockMove.y=0,e},getWheel(){var e=this.wheel;return this.wheel=0,e},getClick(){var e=this.click;return this.click=null,e},setup(t={}){this.lockElt=t.lockElt,onmousemove=e=>{var t=this[x.pointerLockElement?"lockMove":"move"];t.x+=e.movementX,t.y+=e.movementY},onkeydown=e=>{this.down[e.key]=!0,!e.repeat&&t.keys&&t.keys[e.key]&&(t.keys[e.key](),e.preventDefault())},onkeyup=e=>{this.down[e.key]=!1},onwheel=e=>{this.wheel+=e.deltaY};oncontextmenu=onclick=e=>{var{clientX:e,clientY:t,button:r}=e;this.click={clientX:e,clientY:t,button:r,left:0===r,right:2===r,locked:!!x.pointerLockElement}}}};const{sin:b,cos:z,atan2:w,PI:k,sqrt:$}=Math;class S{constructor(e=0,t=0,r=0){"object"==typeof e&&(t=e.y,r=e.z,e=e.x),this.x=e,this.y=t,this.z=r}copy(){return new S(this.x,this.y,this.z)}copyTo(e){e.x=this.x,e.y=this.y,e.z=this.z}add(e){return new S(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new S(this.x-e.x,this.y-e.y,this.z-e.z)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2+this.z**2}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2+(this.z-e.z)**2}normalize(e=1){var t=this.length();return t?this.scale(e/t):new S(0,e,0)}scale(e){return new S(this.x*e,this.y*e,this.z*e)}cross(e){var{x:t,y:r,z:n}=this;return new S(r*e.z-n*e.y,n*e.x-t*e.z,t*e.y-r*e.x)}rotate(e,t,r){return this.rotateX(e).rotateY(t).rotateZ(r)}rotateX(e=0){var t=this.x,r=this.y*z(e)-this.z*b(e);return e=this.y*b(e)+this.z*z(e),new S(t,r,e)}rotateY(e=0){var t=this.x*z(e)+this.z*b(e),r=this.y;return e=-this.x*b(e)+this.z*z(e),new S(t,r,e)}rotateZ(e=0){var t=this.x*z(e)-this.y*b(e);return e=this.x*b(e)+this.y*z(e),new S(t,e,this.z)}toAngles(e){let{x:t,y:r,z:n}=this;e&&(t=e.x-t,r=e.y-r,n=e.z-n),e=w(r,t);var o=w(-n,$(t*t+r*r)),a=0;return 0===t&&0===r||(a=$(t*t+r*r),a=w(n,a)),{roll:a,pitch:o,yaw:e}}toWAngles(e){var{roll:e,pitch:t,yaw:r}=this.toAngles(e);return{rx:180/k*e,ry:180/k*t,rz:180/k*r}}}const{max:M,PI:G}=Math,H=2*G,_=document;var J=a=0;const B={x:0,y:0,z:499,rx:-90,ry:0,rz:0,vel:{x:0,y:0,z:-16},thrust:{x:0,y:0,z:0},fireCooldown:0,r:2,passType:"ship",passthru:["plasma"],shieldOpacity:0,sight:700,aggro:0,thrustCooldown:0,hp:5,facing:{x:0,y:1,z:0}},Q={...structuredClone(B),passType:"klaxShip",passthru:["klaxPlasma"],facing:{x:1,y:0,z:0}},ee=[],E=1e3/60,L={back:-1.5,up:.51,rx:80,ry:0,rz:0},C={rx:-90,ry:0,rz:0},A=[B],T={},I=new class{constructor(e){this.seed=e}rand(e=1,t=0){return this.seed^=this.seed<<13,this.seed^=this.seed>>>17,this.seed^=this.seed<<5,t+(e-t)*Math.abs(this.seed%1e9)/1e9}int(e,t=0){return Math.floor(this.rand(e,t))}sign(){return 2*this.randInt(2)-1}}(1233),P={},F=["Check steering: [Tab] to toggle mouse-lock","Thrusters: [W]","Fire weapons: [Space] or [Click]"].map(e=>({t:e,done:0})),te={plasma:{vScale:40,tScale:5e-4,damage:1},photon:{vScale:15,tScale:1e-4,damage:3}};addEventListener("DOMContentLoaded",()=>{j(),setInterval(X,E)}),window.g={renderables:T,ship:B,input:v,physicsEnts:A}}();
</script>
		
		<style>
			body {
				background: #111;
				padding: 0;
				margin: 0;
				overflow: hidden;
				color: #ebd694;
				font-family: 'Trebuchet MS', Arial, sans-serif;
				text-align: center;
			}
			#canvas {
				width: 100vmin;
				height: 100vmin;
				margin: 0 auto;
			}
			/* canvas { image-rendering: pixelated; } */
			#goals {
				position: absolute;
				top: 0;
				right: 0;
				list-style-type: square;
			}
			.done {
				text-decoration: line-through;
				opacity: 0.5;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas" width="800" height="800"></canvas>
		<p id="goals">[Tab] = 🖱️ Mouselock steering</p>
		<i id="loaded" style="display: none"></i>
	</body>
</html>
